!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=12)}([function(e,r){e.exports=require("graphql")},function(e,r){e.exports=require("cluster")},function(e,r){e.exports=require("os")},function(e,r){e.exports=require("redis")},function(e,r){e.exports=require("graphql-subscriptions")},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("koa")},function(e,r){e.exports=require("kcors")},function(e,r){e.exports=require("koa-router")},function(e,r){e.exports=require("koa-graphql")},function(e,r){e.exports=require("graphql-playground-middleware-koa")},function(e,r){e.exports=require("subscriptions-transport-ws")},function(e,r,t){e.exports=t(13)},function(e,r,t){"use strict";t.r(r);var n=t(1),o=t.n(n),s=t(2),a=t.n(s),i=t(3);const u=t.n(i).a.createClient();u.on("error",(function(e){console.error(e)}));const l=e=>new Promise((r,t)=>{u.lrange(e,0,-1,(function(e,n){e&&t(e),r(n)}))}),c=(e,r,t)=>{if("object"==typeof r){const n=JSON.stringify(r);return u.rpush([e,n],t)}return u.rpush([e,r],t)},p=(e,r)=>u.llen(e,r),T=e=>new Promise((r,t)=>{u.get(e,(e,n)=>{e&&t(e),r(n)})});var S=u;const I=e=>{const r=e%global.workers.length;return global.workers[r]},d=(e=y[0],r=y[1])=>Math.random()*(r-e+1)+e,E="CREATE",f="TEST",b="SELECTION",L="ANALYZE",y=[0,100],N=(e,r)=>{const t=JSON.parse(e||"{}"),n=JSON.parse(r||"{} ");return Number.parseFloat(t.result)>Number.parseFloat(n.result)?t:n},D=()=>{const e=d();return c("POPULATION_LIST",e,()=>process.send({type:P.CREATED_INDIVIDUALS}))},g=({payload:e})=>{const{individual:r}=e,t=(n=Number.parseFloat(r),2*Math.cos(.39*n)+5*Math.sin(.5*n)+.5*Math.cos(.1*n)+10*Math.sin(.7*n)+5*Math.sin(1*n)+5*Math.sin(.35*n));var n;return c("TESTED_LIST",{value:r,result:t},()=>{process.send({type:P.TESTED_INDIVIDUALS})})},h=async({payload:e})=>{const r=await l("TESTED_LIST"),t=(e=>{const r=.5*y[1],t=e+.1*(d(y[0],r)-d(y[0],r));return t>y[1]?t-y[1]:t<y[0]?t+y[1]:t})(await(async e=>{const r=await T("BEST_RESULT"),t=N(e[Math.round(d(0,3))],e[Math.round(d(0,3))]),n=N(e[Math.round(d(0,3))],e[Math.round(d(0,3))]);return(Number.parseFloat(t.value)+Number.parseFloat(n.value)+Number.parseFloat(JSON.parse(r).value))/3})(r));c("POPULATION_LIST",t,()=>process.send({type:P.SELECTED_INDIVIDUALS}))},_="CREATE_POPULATION_INDIVIDUAL",A="TEST_INDIVIDUAL",v="SELECT_INDIVIDUAL";var O=t(4);const w={NEW:"NEW_RESULT"};var m=new O.PubSub;const P={START:"START",CREATED_INDIVIDUALS:"CREATED_INDIVIDUALS",TESTED_INDIVIDUALS:"TESTED_INDIVIDUALS",SELECTED_INDIVIDUALS:"SELECTED_INDIVIDUALS"},U=()=>{p("POPULATION_LIST",(e,r)=>{if(global.step===E)return 5===r?(global.step=f,x()):void 0})},x=async()=>{(await l("POPULATION_LIST")).forEach((e,r)=>{I(r).send({type:A,payload:{individual:e}})})},q=async()=>{const e=await l("TESTED_LIST"),r=await(async e=>e.reduce((e,r,t)=>{const{result:n,value:o}=JSON.parse(r);return n>e.result?{value:o,result:n,index:t}:e},{result:0}))(e);(e=>{S.set("BEST_RESULT",JSON.stringify(e)),S.del("POPULATION_LIST"),c("POPULATION_LIST",Number.parseFloat(e.value))})(r),e.filter((e,t)=>t!==r.index).forEach((e,r)=>{I(r).send({type:v,payload:{individual:e}})})},R=async()=>{const e=await T("GENERATIONS")||1,r=await T("BEST_RESULT"),{result:t}=JSON.parse(r);return c("PAST_LIST",t),S.set("GENERATIONS",`${Number.parseInt(e)+1}`),(async({generation:e,fitness:r})=>{await m.publish(w.NEW,{NewResult:{fitness:r,generation:e}})})({generation:Number.parseInt(e),fitness:t})},M=async()=>(await R(),global.step=E,S.del("TESTED_LIST"),U());var C=({type:e})=>{switch(e){case P.START:return new Array(5).fill(null).forEach((e,r)=>{I(r).send({type:_})});case P.CREATED_INDIVIDUALS:return U();case P.TESTED_INDIVIDUALS:return void p("TESTED_LIST",async(e,r)=>{if(global.step===f)return 5===r?(global.step=b,q()):void 0});case P.SELECTED_INDIVIDUALS:return void p("POPULATION_LIST",(e,r)=>{if(global.step===b)return 5===r?(global.step=L,M()):void 0});default:return}},k=t(5),V=t(6),j=t.n(V),G=t(7),F=t.n(G),Q=t(8),J=t.n(Q),W=t(9),B=t.n(W),Y=t(10),Z=t.n(Y),$=t(11),z=t(0);var H={type:new z.GraphQLObjectType({name:"NewResultPayload",fields:()=>({fitness:{type:z.GraphQLFloat,resolve:({fitness:e})=>e},generation:{type:z.GraphQLInt,resolve:({generation:e})=>e}})}),subscribe:()=>m.asyncIterator(w.NEW)},K=new z.GraphQLObjectType({name:"Subscription",fields:{NewResult:H}});const X=new z.GraphQLObjectType({name:"Query",description:"The root of all... queries",fields:()=>({status:{type:z.GraphQLString,resolve:()=>"online"}})});var ee=new z.GraphQLSchema({query:X,subscription:K});global.workers=[],global.step=E;const re=a.a.cpus().length;var te=()=>{S.del("POPULATION_LIST"),S.del("TESTED_LIST"),S.del("PAST_LIST"),S.del("GENERATIONS"),S.del("BEST_RESULT");for(let e=0;e<re;e++){const e=o.a.fork();global.workers.push(e),e.on("message",e=>C(e))}(()=>{const e=new j.a,r=new J.a;r.all("/playground",Z()({endpoint:"/graphql",subscriptionEndpoint:"ws://localhost:3000/subscriptions"})),r.all("/graphql",B()({schema:ee,graphiql:!1})),e.use(F()()),e.use(r.routes()).use(r.allowedMethods());const t=Object(k.createServer)(e.callback());t.listen(3e3,()=>{console.log("Server started on port 3000"),$.SubscriptionServer.create({onConnect:e=>console.log("Client subscription connected!",e),onDisconnect:()=>console.log("Client subscription disconnected!"),execute:z.execute,subscribe:z.subscribe,schema:ee},{server:t,path:"/subscriptions"})})})(),C({type:P.START})};var ne=e=>{const{type:r}=e;switch(r){case _:return D();case A:return g(e);case v:return h(e);default:return}};var oe=()=>{o.a.worker.on("message",e=>ne(e))};o.a.isMaster?te():oe(),o.a.on("exit",e=>{console.log("mayday! mayday! worker",e.id," is no more!"),o.a.fork()}),o.a.on("online",(function(e){console.log("Worker "+e.process.pid+" is listening")}))}]);